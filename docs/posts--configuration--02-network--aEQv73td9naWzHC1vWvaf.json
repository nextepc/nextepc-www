{"data":{"title":"Network Settings","order":2,"page":"configuration","_entry":"posts/configuration/02-network.md","name":"02-network","category":"configuration","date":"2021-05-06T19:59:14.905Z","url":"/configuration/02-network"},"content":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Please note that nextepc.conf is used only if NextEPC is executed through ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":75,"offset":75}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"nextepc-epcd","position":{"start":{"line":2,"column":76,"offset":76},"end":{"line":2,"column":88,"offset":88}}}],"position":{"start":{"line":2,"column":75,"offset":75},"end":{"line":2,"column":89,"offset":89}}},{"type":"text","value":". Otherwise, ","position":{"start":{"line":2,"column":89,"offset":89},"end":{"line":2,"column":102,"offset":102}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"mme.conf","position":{"start":{"line":2,"column":103,"offset":103},"end":{"line":2,"column":111,"offset":111}}}],"position":{"start":{"line":2,"column":102,"offset":102},"end":{"line":2,"column":112,"offset":112}}},{"type":"text","value":", ","position":{"start":{"line":2,"column":112,"offset":112},"end":{"line":2,"column":114,"offset":114}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"sgw.conf","position":{"start":{"line":2,"column":115,"offset":115},"end":{"line":2,"column":123,"offset":123}}}],"position":{"start":{"line":2,"column":114,"offset":114},"end":{"line":2,"column":124,"offset":124}}},{"type":"text","value":", ","position":{"start":{"line":2,"column":124,"offset":124},"end":{"line":2,"column":126,"offset":126}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"pgw.conf","position":{"start":{"line":2,"column":127,"offset":127},"end":{"line":2,"column":135,"offset":135}}}],"position":{"start":{"line":2,"column":126,"offset":126},"end":{"line":2,"column":136,"offset":136}}},{"type":"text","value":", ","position":{"start":{"line":2,"column":136,"offset":136},"end":{"line":2,"column":138,"offset":138}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"hss.conf","position":{"start":{"line":2,"column":139,"offset":139},"end":{"line":2,"column":147,"offset":147}}}],"position":{"start":{"line":2,"column":138,"offset":138},"end":{"line":2,"column":148,"offset":148}}},{"type":"text","value":", and ","position":{"start":{"line":2,"column":148,"offset":148},"end":{"line":2,"column":154,"offset":154}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"pcrf.conf","position":{"start":{"line":2,"column":155,"offset":155},"end":{"line":2,"column":164,"offset":164}}}],"position":{"start":{"line":2,"column":154,"offset":154},"end":{"line":2,"column":165,"offset":165}}},{"type":"text","value":" should be modifed for the configuration. ","position":{"start":{"line":2,"column":165,"offset":165},"end":{"line":2,"column":207,"offset":207}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":207,"offset":207}}},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[],"position":{"start":{"line":4,"column":1,"offset":209},"end":{"line":4,"column":6,"offset":214}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"IP Connectivity between Network Entities","position":{"start":{"line":6,"column":4,"offset":219},"end":{"line":6,"column":44,"offset":259}}}],"position":{"start":{"line":6,"column":1,"offset":216},"end":{"line":6,"column":44,"offset":259}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The minimum requirement of having IP connectvity is to modify the configuration files of MME and SGW.","position":{"start":{"line":8,"column":1,"offset":261},"end":{"line":8,"column":102,"offset":362}}}],"position":{"start":{"line":8,"column":1,"offset":261},"end":{"line":8,"column":102,"offset":362}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Modification of MME config","position":{"start":{"line":11,"column":7,"offset":371},"end":{"line":11,"column":33,"offset":397}}}],"position":{"start":{"line":11,"column":3,"offset":367},"end":{"line":11,"column":33,"offset":397}}},{"type":"text","value":"In ","position":{"start":{"line":12,"column":1,"offset":398},"end":{"line":12,"column":4,"offset":401}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"/etc/nextepc/mme.conf"}],"position":{"start":{"line":12,"column":4,"offset":401},"end":{"line":12,"column":27,"offset":424}}},{"type":"text","value":", go to mme → s1ap. Please set your IP address after ","position":{"start":{"line":12,"column":27,"offset":424},"end":{"line":12,"column":85,"offset":482}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"addr:"}],"position":{"start":{"line":12,"column":85,"offset":482},"end":{"line":12,"column":92,"offset":489}}},{"type":"text","value":" keyword:","position":{"start":{"line":12,"column":92,"offset":489},"end":{"line":12,"column":101,"offset":498}}}],"position":{"start":{"line":11,"column":1,"offset":365},"end":{"line":12,"column":101,"offset":498}}},{"type":"text","value":"\n"}],"position":{"start":{"line":11,"column":1,"offset":365},"end":{"line":12,"column":101,"offset":498}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"mme:\n    freeDiameter: mme.conf\n    s1ap:\n      addr: <IP address>\n...\n"}],"position":{"start":{"line":13,"column":1,"offset":499},"end":{"line":19,"column":4,"offset":581}}}],"position":{"start":{"line":13,"column":1,"offset":499},"end":{"line":19,"column":4,"offset":581}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Modification of SGW config","position":{"start":{"line":21,"column":7,"offset":589},"end":{"line":21,"column":33,"offset":615}}}],"position":{"start":{"line":21,"column":3,"offset":585},"end":{"line":21,"column":33,"offset":615}}},{"type":"text","value":"In ","position":{"start":{"line":22,"column":1,"offset":616},"end":{"line":22,"column":4,"offset":619}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"/etc/nextepc/sgw.conf"}],"position":{"start":{"line":22,"column":4,"offset":619},"end":{"line":22,"column":27,"offset":642}}},{"type":"text","value":", go to sgw → gtpu. Please set your IP address after ","position":{"start":{"line":22,"column":27,"offset":642},"end":{"line":22,"column":85,"offset":700}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"addr:"}],"position":{"start":{"line":22,"column":85,"offset":700},"end":{"line":22,"column":92,"offset":707}}},{"type":"text","value":" keyword.","position":{"start":{"line":22,"column":92,"offset":707},"end":{"line":22,"column":101,"offset":716}}}],"position":{"start":{"line":21,"column":1,"offset":583},"end":{"line":22,"column":101,"offset":716}}},{"type":"text","value":"\n"}],"position":{"start":{"line":21,"column":1,"offset":583},"end":{"line":22,"column":101,"offset":716}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"sgw:\n    gtpc:\n      addr: 127.0.0.2\n    gtpu:\n      addr: <IP address>\n...\n"}],"position":{"start":{"line":24,"column":1,"offset":718},"end":{"line":31,"column":4,"offset":805}}}],"position":{"start":{"line":24,"column":1,"offset":718},"end":{"line":31,"column":4,"offset":805}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Internet Access for UEs","position":{"start":{"line":33,"column":4,"offset":810},"end":{"line":33,"column":27,"offset":833}}}],"position":{"start":{"line":33,"column":1,"offset":807},"end":{"line":33,"column":27,"offset":833}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First, please make sure that ","position":{"start":{"line":34,"column":1,"offset":834},"end":{"line":34,"column":30,"offset":863}}},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ip_forwarding = 1","position":{"start":{"line":34,"column":31,"offset":864},"end":{"line":34,"column":48,"offset":881}}}],"position":{"start":{"line":34,"column":30,"offset":863},"end":{"line":34,"column":49,"offset":882}}},{"type":"text","value":":","position":{"start":{"line":34,"column":49,"offset":882},"end":{"line":34,"column":50,"offset":883}}}],"position":{"start":{"line":34,"column":1,"offset":834},"end":{"line":34,"column":50,"offset":883}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"sysctl net.ipv4.ip_forward\nnet.ipv4.ip_forward = 0\n\nsudo sh -c \"echo 1 > /proc/sys/net/ipv4/ip_forward\"\n"}],"position":{"start":{"line":35,"column":1,"offset":884},"end":{"line":40,"column":4,"offset":999}}}],"position":{"start":{"line":35,"column":1,"offset":884},"end":{"line":40,"column":4,"offset":999}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Second, either method A or B is required for UEs to have Internet connectivity.","position":{"start":{"line":42,"column":1,"offset":1001},"end":{"line":42,"column":80,"offset":1080}}}],"position":{"start":{"line":42,"column":1,"offset":1001},"end":{"line":42,"column":80,"offset":1080}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"A. Adding a route on the gateway router","position":{"start":{"line":44,"column":7,"offset":1088},"end":{"line":44,"column":46,"offset":1127}}}],"position":{"start":{"line":44,"column":3,"offset":1084},"end":{"line":44,"column":46,"offset":1127}}},{"type":"text","value":"By default, a LTE UE will receive a IP address with the network address of 45.45.0.0/16. If you have a ","position":{"start":{"line":45,"column":1,"offset":1128},"end":{"line":45,"column":104,"offset":1231}}},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Network_address_translation"},"children":[{"type":"text","value":"NAT","position":{"start":{"line":45,"column":105,"offset":1232},"end":{"line":45,"column":108,"offset":1235}}}],"position":{"start":{"line":45,"column":104,"offset":1231},"end":{"line":45,"column":168,"offset":1295}}},{"type":"text","value":" router (e.g., wireless router, cable modem, etc), the LTE UE can reach Internet in uplink, but it cannot in downlink. It's because the NAT router has no idea on 45.45.0.0/16, so adding a route is required. The following example shows adding two routes for 45.45.0.0/16 and cafe::0/64 in Linux:","position":{"start":{"line":45,"column":168,"offset":1295},"end":{"line":45,"column":462,"offset":1589}}}],"position":{"start":{"line":44,"column":1,"offset":1082},"end":{"line":45,"column":462,"offset":1589}}},{"type":"text","value":"\n"}],"position":{"start":{"line":44,"column":1,"offset":1082},"end":{"line":45,"column":462,"offset":1589}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"sudo ip route add 45.45.0.0/16 via <'PGW IP address'>\nsudo ip route add cafe::0/64 via <'PGW IP address'>\n"}],"position":{"start":{"line":46,"column":1,"offset":1590},"end":{"line":49,"column":4,"offset":1707}}}],"position":{"start":{"line":46,"column":1,"offset":1590},"end":{"line":49,"column":4,"offset":1707}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"B. NAT on PGW","position":{"start":{"line":51,"column":7,"offset":1715},"end":{"line":51,"column":20,"offset":1728}}}],"position":{"start":{"line":51,"column":3,"offset":1711},"end":{"line":51,"column":20,"offset":1728}}},{"type":"text","value":"NAT can be done on NextEPC's PGW. You execute the following command in PGW installed host. Please check your outgoing network interface name (e.g ","position":{"start":{"line":52,"column":1,"offset":1729},"end":{"line":52,"column":147,"offset":1875}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"enp0s25"}],"position":{"start":{"line":52,"column":147,"offset":1875},"end":{"line":52,"column":156,"offset":1884}}},{"type":"text","value":", ","position":{"start":{"line":52,"column":156,"offset":1884},"end":{"line":52,"column":158,"offset":1886}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"wls3"}],"position":{"start":{"line":52,"column":158,"offset":1886},"end":{"line":52,"column":164,"offset":1892}}},{"type":"text","value":"):","position":{"start":{"line":52,"column":164,"offset":1892},"end":{"line":52,"column":166,"offset":1894}}}],"position":{"start":{"line":51,"column":1,"offset":1709},"end":{"line":52,"column":166,"offset":1894}}},{"type":"text","value":"\n"}],"position":{"start":{"line":51,"column":1,"offset":1709},"end":{"line":52,"column":166,"offset":1894}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"sudo iptables -t nat -A POSTROUTING -o <'interface-name'> -j MASQUERADE\nsudo iptables -I INPUT -i pgwtun -j ACCEPT\n"}],"position":{"start":{"line":53,"column":1,"offset":1895},"end":{"line":56,"column":4,"offset":2021}}}],"position":{"start":{"line":53,"column":1,"offset":1895},"end":{"line":56,"column":4,"offset":2021}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Default Config","position":{"start":{"line":59,"column":4,"offset":2027},"end":{"line":59,"column":18,"offset":2041}}}],"position":{"start":{"line":59,"column":1,"offset":2024},"end":{"line":59,"column":18,"offset":2041}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Network address settings","position":{"start":{"line":61,"column":7,"offset":2049},"end":{"line":61,"column":31,"offset":2073}}}],"position":{"start":{"line":61,"column":3,"offset":2045},"end":{"line":61,"column":31,"offset":2073}}}],"position":{"start":{"line":61,"column":1,"offset":2043},"end":{"line":61,"column":31,"offset":2073}}},{"type":"text","value":"\n"}],"position":{"start":{"line":61,"column":1,"offset":2043},"end":{"line":61,"column":31,"offset":2073}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"* MME\n  S1AP: listen on all address avaiable in system\n  GTP-C: listen on the first IP address in system\n  DIAMETER: 127.0.0.2 (No TLS)\n\n* SGW\n  GTP-C: 127.0.0.2\n  GTP-U: listen on the first IP address in system\n\n* PGW\n  GTP-C: Both 127.0.0.3 and [::1]\n  GTP-U: Both 127.0.0.3 and [::1]\n  DIAMETER: 127.0.0.3 (No TLS)\n\n* HSS\n  DIAMETER: 127.0.0.4 (No TLS)\n\n* PCRF\n  DIAMETER: 127.0.0.5 (No TLS)\n"}],"position":{"start":{"line":62,"column":1,"offset":2074},"end":{"line":82,"column":4,"offset":2476}}}],"position":{"start":{"line":62,"column":1,"offset":2074},"end":{"line":82,"column":4,"offset":2476}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"UE IP addressing","position":{"start":{"line":84,"column":7,"offset":2484},"end":{"line":84,"column":23,"offset":2500}}}],"position":{"start":{"line":84,"column":3,"offset":2480},"end":{"line":84,"column":23,"offset":2500}}}],"position":{"start":{"line":84,"column":1,"offset":2478},"end":{"line":84,"column":23,"offset":2500}}},{"type":"text","value":"\n"}],"position":{"start":{"line":84,"column":1,"offset":2478},"end":{"line":84,"column":23,"offset":2500}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"* IPv4 : 45.45.0.1/16\n* IPv6 : cafe::1/64\n"}],"position":{"start":{"line":85,"column":1,"offset":2501},"end":{"line":88,"column":4,"offset":2550}}}],"position":{"start":{"line":85,"column":1,"offset":2501},"end":{"line":88,"column":4,"offset":2550}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"DNS setttings","position":{"start":{"line":90,"column":7,"offset":2558},"end":{"line":90,"column":20,"offset":2571}}}],"position":{"start":{"line":90,"column":3,"offset":2554},"end":{"line":90,"column":20,"offset":2571}}}],"position":{"start":{"line":90,"column":1,"offset":2552},"end":{"line":90,"column":20,"offset":2571}}},{"type":"text","value":"\n"}],"position":{"start":{"line":90,"column":1,"offset":2552},"end":{"line":90,"column":20,"offset":2571}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"* IPv4\n  Primary : 8.8.8.8 \n  Secondary : 8.8.4.4\n\n* IPv6\n  Primary : 2001:4860:4860::8888\n  Secondary : 2001:4860:4860::8844\n"}],"position":{"start":{"line":91,"column":1,"offset":2572},"end":{"line":99,"column":4,"offset":2705}}}],"position":{"start":{"line":91,"column":1,"offset":2572},"end":{"line":99,"column":4,"offset":2705}}}],"data":{"quirksMode":false},"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"raw":"\nPlease note that nextepc.conf is used only if NextEPC is executed through *nextepc-epcd*. Otherwise, *mme.conf*, *sgw.conf*, *pgw.conf*, *hss.conf*, and *pcrf.conf* should be modifed for the configuration. \n\n<br/>\n\n## IP Connectivity between Network Entities\n\nThe minimum requirement of having IP connectvity is to modify the configuration files of MME and SGW.\n\n\n* ### Modification of MME config\nIn `/etc/nextepc/mme.conf`, go to mme &rarr; s1ap. Please set your IP address after `addr:` keyword:\n```yaml\nmme:\n    freeDiameter: mme.conf\n    s1ap:\n      addr: <IP address>\n...\n```\n\n* ### Modification of SGW config\nIn `/etc/nextepc/sgw.conf`, go to sgw &rarr; gtpu. Please set your IP address after `addr:` keyword.\n\n```yaml\nsgw:\n    gtpc:\n      addr: 127.0.0.2\n    gtpu:\n      addr: <IP address>\n...\n```\n\n## Internet Access for UEs\nFirst, please make sure that *ip_forwarding = 1*:\n```bash\nsysctl net.ipv4.ip_forward\nnet.ipv4.ip_forward = 0\n\nsudo sh -c \"echo 1 > /proc/sys/net/ipv4/ip_forward\"\n```\n\nSecond, either method A or B is required for UEs to have Internet connectivity.\n\n* ### A. Adding a route on the gateway router\nBy default, a LTE UE will receive a IP address with the network address of 45.45.0.0/16. If you have a [NAT](https://en.wikipedia.org/wiki/Network_address_translation) router (e.g., wireless router, cable modem, etc), the LTE UE can reach Internet in uplink, but it cannot in downlink. It's because the NAT router has no idea on 45.45.0.0/16, so adding a route is required. The following example shows adding two routes for 45.45.0.0/16 and cafe::0/64 in Linux:\n```bash\nsudo ip route add 45.45.0.0/16 via <'PGW IP address'>\nsudo ip route add cafe::0/64 via <'PGW IP address'>\n```\n\n* ### B. NAT on PGW\nNAT can be done on NextEPC's PGW. You execute the following command in PGW installed host. Please check your outgoing network interface name (e.g `enp0s25`, `wls3`):\n```bash\nsudo iptables -t nat -A POSTROUTING -o <'interface-name'> -j MASQUERADE\nsudo iptables -I INPUT -i pgwtun -j ACCEPT\n```\n\n\n## Default Config\n\n* ### Network address settings\n```\n* MME\n  S1AP: listen on all address avaiable in system\n  GTP-C: listen on the first IP address in system\n  DIAMETER: 127.0.0.2 (No TLS)\n\n* SGW\n  GTP-C: 127.0.0.2\n  GTP-U: listen on the first IP address in system\n\n* PGW\n  GTP-C: Both 127.0.0.3 and [::1]\n  GTP-U: Both 127.0.0.3 and [::1]\n  DIAMETER: 127.0.0.3 (No TLS)\n\n* HSS\n  DIAMETER: 127.0.0.4 (No TLS)\n\n* PCRF\n  DIAMETER: 127.0.0.5 (No TLS)\n```\n\n* ### UE IP addressing\n```\n* IPv4 : 45.45.0.1/16\n* IPv6 : cafe::1/64\n```\n\n* ### DNS setttings\n```\n* IPv4\n  Primary : 8.8.8.8 \n  Secondary : 8.8.4.4\n\n* IPv6\n  Primary : 2001:4860:4860::8888\n  Secondary : 2001:4860:4860::8844\n```\n"}